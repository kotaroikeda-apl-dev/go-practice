# 値レシーバーとポインタレシーバーの選択

このディレクトリでは、値レシーバーとポインタレシーバーのどちらを選ぶべきか、その判断基準を学びます。

## ポインタレシーバーを使う理由

### 1. 値を変更する必要がある場合

メソッドがレシーバーの値を変更する必要がある場合、ポインタレシーバーを使う必要があります。

```go
func (p *Point) Scale(factor float64) {
    p.X = p.X * factor
    p.Y = p.Y * factor
}
```

### 2. 効率性のため（大きな構造体のコピーを避ける）

大きな構造体の場合、値レシーバーを使うとメソッド呼び出しのたびに構造体全体がコピーされます。これは非効率です。

```go
type LargeStruct struct {
    Data [1000]int
    Name string
}

// 値レシーバーだと毎回コピーが発生（非効率）
func (ls LargeStruct) UpdateData(index int, value int) { ... }

// ポインタレシーバーだとコピーを避けられる（効率的）
func (ls *LargeStruct) UpdateData(index int, value int) { ... }
```

## 一貫性の重要性

同じ型のメソッドは、**全て値レシーバーかポインタレシーバーのどちらかに統一**することが推奨されます。

### 良い例：一貫性がある

```go
type Point struct {
    X, Y float64
}

// 全てポインタレシーバーで統一
func (p *Point) Scale(factor float64) { ... }  // 値を変更する
func (p *Point) Length() float64 { ... }       // 値を変更しないが、一貫性のため
```

### 悪い例：一貫性がない（避けるべき）

```go
type Point struct {
    X, Y float64
}

func (p *Point) Scale(factor float64) { ... }  // ポインタレシーバー
func (p Point) Length() float64 { ... }        // 値レシーバー（一貫性がない）
```

## 判断基準のまとめ

| 状況                                     | 推奨されるレシーバー | 理由               |
| ---------------------------------------- | -------------------- | ------------------ |
| 値を変更する必要がある                   | ポインタレシーバー   | 必須               |
| 大きな構造体                             | ポインタレシーバー   | 効率性             |
| 小さな構造体で値を変更しない             | 値レシーバーでも可   | ただし一貫性を保つ |
| 同じ型の他のメソッドがポインタレシーバー | ポインタレシーバー   | 一貫性のため       |
| 同じ型の他のメソッドが値レシーバー       | 値レシーバー         | 一貫性のため       |

## 実践的なガイドライン

1. **値を変更するメソッド** → 必ずポインタレシーバー
2. **大きな構造体** → ポインタレシーバーを推奨（効率性のため）
3. **小さな構造体で値を変更しないメソッド** → 値レシーバーでも可
4. **一貫性を保つ** → 同じ型のメソッドは全て同じレシーバータイプに統一

## 実行方法

```bash
go run main.go
```

## 出力例

```
=== 値レシーバーとポインタレシーバーの選択 ===

【理由1: 値を変更する必要がある場合】
初期値: {X:3 Y:4}
Scale(2)後: {X:6 Y:8}

【理由2: 効率性のため（大きな構造体のコピーを避ける）】
Data[0] = 100, Data[999] = 200
大きな構造体の場合、値レシーバーだと毎回コピーが発生するため非効率
ポインタレシーバーを使うことで、コピーを避けられる

【一貫性の重要性】
同じ型のメソッドは、全て値レシーバーかポインタレシーバーの
どちらかに統一することが推奨されます。

Point型の例:
- Scale() は値を変更するためポインタレシーバー
- Length() は値を変更しないが、一貫性のためポインタレシーバー

LargeStruct型の例:
- UpdateData() は値を変更するためポインタレシーバー
- GetName() は値を変更しないが、一貫性のためポインタレシーバー
- SetName() は値を変更するためポインタレシーバー

LargeStructのName: Test
SetName後: Updated
```
