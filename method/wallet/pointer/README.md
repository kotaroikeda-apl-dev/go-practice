# ウォレットシステム

このディレクトリでは、Go の method を使った設計を学ぶためのサンプルコードを提供します。

## 学習の意図

このサンプルコードは、以下のことを学ぶことを目的としています：

### 1. Go の method を使った設計パターン

Go にはクラスはありませんが、struct に method を定義することで、オブジェクト指向的な設計が可能です。このコードでは、**interface を使わずに struct + method のみで設計**することで、以下を学びます：

- method によるカプセル化の実現方法
- struct に責務を持たせる設計パターン
- method を通じた状態管理のベストプラクティス

### 2. 「状態」と「ルール」を method に閉じ込める設計

重要な設計原則として、**状態（データ）とルール（ロジック）を method に閉じ込める**ことを学びます：

- **状態の保護**: フィールドを非公開にし、直接アクセスを防ぐ
- **ルールの集約**: バリデーションやビジネスロジックを method 内に集約
- **整合性の保証**: method 経由でのみ状態変更を許可することで、不正な状態遷移を防ぐ

### 3. 責務の分離と委譲パターン

複数の struct を組み合わせる際の責務分担を学びます：

- **Account（1 口座の状態とルール）**: 1 口座の状態（残高）とルール（バリデーション）を持つ
- **Wallet（全体の窓口）**: 外部への窓口として機能し、Account のルールに委譲、履歴管理を担当
- **委譲パターン**: Wallet が Account の method に委譲することで、責務を明確に分離

### 4. 実務で使える設計パターン

実務でよく使われる設計パターンを学びます：

- **コンストラクタパターン**: `NewAccount`、`NewWallet` などで初期状態を保証
- **Getter パターン**: `Balance()` でフィールドへの直接アクセスを防ぐ
- **エラーハンドリング**: method 内でバリデーションを行い、エラーを返す

## 目的

- Go の method を使った設計を理解する
- interface は使わず、struct + method のみで表現する
- 「状態」と「ルール」を method に閉じ込める設計にする

## 設計のポイント

### 責務分担

- **Account（1 口座の状態とルール）**: 1 口座の状態（残高）とルール（バリデーション）を持つ
- **Wallet（全体の窓口）**: 外部への窓口として機能し、Account のルールに委譲、履歴管理を担当

### カプセル化

- フィールドは非公開（小文字始まり）で、外部から直接アクセスできない
- 状態の変更は必ず method 経由で行う
- `balance` フィールドは外部から直接参照できない

### ルールの適用

- 不正な操作（マイナス入金、残高不足の出金など）は method 内で防ぐ
- バリデーションロジックは Account に集約

## 構造体

### Account

1 口座の状態とルールを管理する構造体。

- `NewAccount(initialBalance int)`: 新しい Account を作成
- `Deposit(amount int)`: 入金を行う（入金額のバリデーション）
- `Withdraw(amount int)`: 出金を行う（出金額のバリデーション、残高チェック）
- `Balance() int`: 現在の残高を取得

### Transaction

入金・出金の履歴を表す構造体。

- `Type`: 取引の種類（入金 or 出金）
- `Amount`: 金額
- `Timestamp`: 取引時刻

### Wallet

全体の窓口として機能する構造体。外部からの要求を受け取り、Account のルールに委譲する。

- `NewWallet(initialBalance int)`: 新しい Wallet を作成
- `Deposit(amount int)`: 入金を行い、取引履歴に追加（Account のルールに委譲）
- `Withdraw(amount int)`: 出金を行い、取引履歴に追加（Account のルールに委譲）
- `Balance() int`: 現在の残高を取得（Account に委譲）
- `Transactions() []*Transaction`: 取引履歴を取得
- `DisplayHistory()`: 現在の残高と取引履歴を表示

## 実行方法

```bash
go run main.go
```

## 出力例

```
=== ウォレットシステムのデモ ===

【初期状態】
=== ウォレット残高: 1000円 ===
取引履歴:
  取引履歴はありません

【500円入金】
入金成功
=== ウォレット残高: 1500円 ===
取引履歴:
  1. 入金 - 500円 (2025-12-13 07:28:21)

【300円出金】
出金成功
=== ウォレット残高: 1200円 ===
取引履歴:
  1. 入金 - 500円 (2025-12-13 07:28:21)
  2. 出金 - 300円 (2025-12-13 07:28:21)

【不正な操作のテスト】
1. マイナス入金を試みる:
   エラー（期待通り）: 入金額は0より大きい必要があります
2. 残高不足の出金を試みる:
   エラー（期待通り）: 残高が不足しています
3. 0円の出金を試みる:
   エラー（期待通り）: 出金額は0より大きい必要があります

=== ウォレット残高: 1200円 ===
取引履歴:
  1. 入金 - 500円 (2025-12-13 07:28:21)
  2. 出金 - 300円 (2025-12-13 07:28:21)

【複数の取引を追加】
=== ウォレット残高: 1350円 ===
取引履歴:
  1. 入金 - 500円 (2025-12-13 07:28:21)
  2. 出金 - 300円 (2025-12-13 07:28:21)
  3. 入金 - 200円 (2025-12-13 07:28:21)
  4. 出金 - 100円 (2025-12-13 07:28:21)
  5. 入金 - 50円 (2025-12-13 07:28:21)
```

## 学べること

1. **カプセル化**: フィールドを非公開にし、method 経由でアクセスすることで、状態の整合性を保つ
2. **責務の分離**: Account が 1 口座の状態とルールを持ち、Wallet が全体の窓口として機能する設計
3. **バリデーション**: method 内でルールを適用し、不正な操作を防ぐ
4. **委譲パターン**: Wallet が Account の method に委譲することで、責務を明確に分離
